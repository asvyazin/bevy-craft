# Архитектура игры Bevy-Craft

## Обзор

Bevy-Craft - это 3D игра, похожая на Minecraft, разработанная на языке Rust с использованием игрового движка Bevy. Игра будет включать в себя генерацию мира, систему блоков, управление игроком и другие основные функции.

## Основные компоненты

### 1. Архитектура Bevy ECS

Игра будет использовать архитектуру Entity-Component-System (ECS) от Bevy:

- **Entities**: Игровые объекты (игрок, блоки, мобы и т.д.)
- **Components**: Данные, прикрепленные к сущностям (позиция, здоровье, тип блока и т.д.)
- **Systems**: Логика, обрабатывающая компоненты (физика, рендеринг, ИИ и т.д.)
- **Resources**: Глобальные данные (настройки мира, состояние игры и т.д.)

### 2. Генерация мира

#### Система генерации мира
- Использование шума Перлина для генерации ландшафта
- Разделение мира на чанки (16x16x16 блоков)
- Генерация биомов (равнины, горы, леса, пустыни и т.д.)
- Генерация структур (деревья, пещеры и т.д.)

#### Структура чанков
```rust
struct Chunk {
    position: IVec3,  // Позиция чанка в мире
    blocks: [[[BlockType; CHUNK_SIZE]; CHUNK_SIZE]; CHUNK_SIZE],
    mesh: Option<Mesh>,  // Сгенерированная mesh для рендеринга
    is_dirty: bool,  // Флаг, указывающий на необходимость перегенерации mesh
}
```

### 3. Система блоков

#### Типы блоков
- Воздух (пустой блок)
- Земля
- Камень
- Дерево
- Листья
- Песок
- Вода
- и т.д.

#### Структура блока
```rust
#[derive(Clone, Copy, PartialEq)]
enum BlockType {
    Air,
    Dirt,
    Stone,
    Wood,
    Leaves,
    Sand,
    Water,
    // ... другие типы блоков
}

struct Block {
    block_type: BlockType,
    position: IVec3,  // Позиция в мире
    // Дополнительные свойства
}
```

### 4. Управление игроком

#### Компоненты игрока
```rust
struct Player {
    health: f32,
    hunger: f32,
    inventory: Inventory,
}

struct PlayerMovement {
    speed: f32,
    jump_force: f32,
    is_grounded: bool,
}
```

#### Системы управления
- Движение (WASD)
- Прыжки (пробел)
- Разрушение блоков (левая кнопка мыши)
- Размещение блоков (правая кнопка мыши)
- Управление камерой (мышь)

### 5. Система инвентаря и крафта

#### Инвентарь
```rust
struct Inventory {
    items: Vec<ItemStack>,
    selected_slot: usize,
}

struct ItemStack {
    item_type: ItemType,
    quantity: u32,
}
```

#### Крафт
- Рецепты крафта
- Крафтовый стол
- Система крафта в инвентаре

### 6. Сохранение и загрузка мира

#### Формат сохранения
- Сохранение мира в бинарном формате
- Сохранение по чанкам
- Сжатие данных

#### Структура сохранения
```rust
struct WorldSave {
    version: u32,
    chunks: HashMap<IVec3, ChunkData>,
    player_data: PlayerData,
    // ... другие данные
}
```

### 7. Система освещения

#### Типы освещения
- Солнечный свет
- Освещение от блоков (факелы, лава и т.д.)
- Динамическое освещение

#### Цикл день/ночь
- 24-часовой цикл
- Влияние на освещение
- Влияние на спавн мобов

### 8. Многопользовательский режим (опционально)

#### Сетевая архитектура
- Клиент-серверная модель
- Протокол WebSocket
- Синхронизация состояния мира
- Синхронизация игроков

### 9. Система мобов и ИИ

#### Типы мобов
- Пассивные мобы (коровы, свиньи и т.д.)
- Враждебные мобы (зомби, скелеты и т.д.)
- Нейтральные мобы (волки и т.д.)

#### ИИ
- Поведение мобов
- Путешествие
- Атака
- Спавн

## План реализации

1. **Настройка проекта**
   - Создание базового проекта Bevy
   - Настройка 3D рендеринга
   - Настройка управления камерой

2. **Генерация мира**
   - Реализация шума Перлина
   - Генерация чанков
   - Генерация биомов

3. **Система блоков**
   - Создание типов блоков
   - Генерация mesh для блоков
   - Рендеринг блоков

4. **Управление игроком**
   - Движение игрока
   - Прыжки
   - Разрушение и размещение блоков

5. **Система инвентаря и крафта**
   - Создание инвентаря
   - Реализация рецептов крафта
   - Крафтовый стол

6. **Сохранение и загрузка мира**
   - Сохранение мира
   - Загрузка мира
   - Сжатие данных

7. **Система освещения**
   - Солнечный свет
   - Освещение от блоков
   - Цикл день/ночь

8. **Многопользовательский режим (опционально)**
   - Сетевая архитектура
   - Синхронизация состояния мира
   - Синхронизация игроков

9. **Система мобов и ИИ**
   - Создание мобов
   - Реализация ИИ
   - Спавн мобов

## Технические требования

- Язык программирования: Rust
- Игровой движок: Bevy
- Версия Rust: 1.70.0 или выше
- Версия Bevy: 0.11.0 или выше

## Зависимости

- `bevy`: Основной игровой движок
- `noise-rs`: Генерация шума Перлина
- `serde`: Сериализация и десериализация данных
- `bincode`: Бинарная сериализация
- `flume`: Каналы для межпоточного взаимодействия
- `rand`: Генерация случайных чисел

## Структура проекта

```
src/
├── main.rs              # Основной файл
├── world/               # Генерация мира
│   ├── mod.rs
│   ├── chunk.rs         # Чанки
│   ├── biome.rs         # Биомы
│   └── generation.rs    # Генерация мира
├── blocks/              # Блоки
│   ├── mod.rs
│   ├── block.rs         # Типы блоков
│   └── mesh.rs          # Генерация mesh
├── player/              # Игрок
│   ├── mod.rs
│   ├── movement.rs      # Движение
│   └── inventory.rs     # Инвентарь
├── systems/             # Игровые системы
│   ├── mod.rs
│   ├── rendering.rs     # Рендеринг
│   ├── physics.rs       # Физика
│   └── lighting.rs      # Освещение
└── utils/               # Утилиты
    ├── mod.rs
    └── noise.rs          # Шум Перлина
```

## Заключение

Эта архитектура предоставляет основную структуру для разработки игры Bevy-Craft. Она может быть расширена и модифицирована по мере развития проекта.